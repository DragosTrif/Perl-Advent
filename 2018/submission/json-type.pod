Title: REST API and the Baby
Topic: Cpanel::JSON::XS::Type
Author: E. Choroba <choroba@cpan.org>

=encoding utf8

How does Santa manage to deliver all the presents to all the children
on one day? The answer is simple: He doesn’t. In many countries, there
are different creatures responsible for the job (if you’re curious,
consult the L<List of Christmas and winter gift
bringers|https://en.wikipedia.org/wiki/List_of_Christmas_and_winter_gift-bringers_by_country>
for details).

We live in a global world. People often work for foreign companies and
sometimes move abroad. In order to satisfy even their children, the
gift bringers had to start cooperating. At the beginning, they used
L<ASN.1|https://metacpan.org/pod/Convert::ASN1> to exchange the data,
then switched to L<XML|https://metacpan.org/pod/XML::Compile::SOAP> at
the beginning of the current century, to enter the Twenty-tens using
L<JSON|https://metacpan.org/pod/JSON>.

=head2 Baby Jesus on Red Hat Enterprise Linux

Let’s look at Baby Jesus, responsible for the central part of Europe
and Latin America. The author of this article is interested in him for
two reasons: Baby Jesus brings the Christmas gifts to his children,
and the Baby’s business runs on Perl.

Until the end of the previous year, Baby Jesus had used Red Hat
Enterprise Linux 6. It featured Perl version 5.10.1, and the web
service used L<JSON::XS|https://metacpan.org/pod/JSON::XS> version
2.27 provided by the vendor. When the Christmas 2017 was over, Kris
Kringle decided to upgrade the system to RHEL7, which included Perl
upgrade to 5.16.3 and JSON::XS to 3.01. Surprisingly, this wasn’t
smooth at all.

After the upgrade, JSON data were different. Some numbers that were
previously not quoted started to appear in double quotes, while others
originally quoted lost their quotes sometimes. Perl powered gift
bringers didn’t have to worry as Perl doesn’t care, but there were
Java businesses that required the format to stay stable. BJ couldn’t
but accept their argument that the data should roundtrip: when you
POST a JSON, you expect to GET the same JSON back.

=head2 System Perl

The investigation carried out showed two causes of the problem: Perl’s
internal flags had changed across the versions, as well as the
heuristics used by the JSON::XS module to guess whether a number
should be quoted or not.

“We told you not to use the system Perl!” shouted other programmers in
the office.

“Good advice,” replied Baby Jesus, “but it wouldn't have helped us.
We'd have probably only discovered the problem earlier when upgrading
Perl or the library.”

=head2 Alternatives

=head2 Solution

=head2 Thanks

Pali, GoodData

=cut

